/*
 * angular-primer 0.0.2
 * (c) 2014 J. Harshbarger
 * Licensed MIT
 */
!function(){"use strict";angular.module("angularprimer",[]).directive("primerTrack",function(){return{restrict:"EA",templateNamespace:"svg",template:"<g ng-transclude></g>",replace:!0,transclude:!0,require:"primerTrack",scope:{sequence:"@",sequenceLength:"&",start:"&",width:"&",height:"&"},controller:function(a,b){var c=a.track=this;c.sequence=function(){return a.sequence},c.sequenceLength=function(){return void 0!==a.sequenceLength()?a.sequenceLength():void 0!==a.sequence?a.sequence.length:100},c.height=function(){return a.height()||10},c.start=b.start?a.start:function(){return 1},c.width=b.width?a.width:function(){return 500},c.xScale=d3.scale.linear()},link:function(a,b,c,d){function e(){d.xScale.domain([d.start()-1||1,d.sequenceLength()+1]).range([f,d.width()+f])}var f=25;a.$watchCollection("[track.sequenceLength(),track.width(),track.start()]",e)}}}).directive("primerFeature",function(){return{restrict:"EA",templateNamespace:"svg",template:'<g><g ng-attr-transform="translate({{translate()}})"><title ng-bind="title()" /><g ng-transclude /></g><g>',replace:!0,transclude:!0,require:["primerFeature","^primerTrack"],scope:{start:"=",end:"=",height:"&",direction:"@"},controller:function(a){var b=this;b.start=function(){return a.start||0},b.end=function(){return a.end||a.start}},link:function(a,b,c,d){function e(){return h.height()/2}function f(){return h.xScale(g.start())}var g=a.feature=d[0],h=a.track=d[1];g.height=angular.isDefined(c.height)?function(){return a.height()||h.height()||10}:g.height=function(){return h.height()||10},g.width=function(){return h.xScale(g.end()+1)-h.xScale(g.start())},a.translate=function(){return""+f()+","+e()},a.title=function(){var a=""+g.start()+"-"+g.end();return h.sequence()&&(a+=" "+h.sequence().substring(g.start()-1,g.end())),a}}}}).directive("primerFeatureShape",function(){var a=10,b={rect:function(a,b){return"M0,-"+b/2+" l"+a+",0 l0,"+b+" l-"+a+",0 z"},"arrow-left":function(b,c){var d=a>b?b:a,e=b-d;return"M0,0 l"+d+","+(c/2+5)+" l0,-5 l"+e+",0 l0,-"+c+" l-"+e+",0 l0,-5 z"},"arrow-right":function(b,c){var d=a>b?b:a,e=b-d;return"M0,-"+c/2+" l"+e+",0 l0,-5 l"+d+","+(c/2+5)+" l-"+d+","+(c/2+5)+" l0,-5 l-"+e+",0 z"}};return{restrict:"EA",templateNamespace:"svg",template:"<path />",replace:!0,transclude:!1,require:["^primerFeature"],scope:{type:"@primerFeatureShape",height:"&"},link:function(a,c,d,e){function f(){var d=g.width()||1,e=a.height()||g.height()||10,f=(a.direction||"none",a.type||"rect");0>d&&(d=1);var h=b[f]||d3.svg.symbol().type(f).size(e*e);c.attr({d:h(d,e)})}var g=a.feature=e[0];a.$watchCollection("[feature.width(),feature.height(),height(),direction,type]",f)}}}).directive("primerLabel",function(){return{restrict:"EA",templateNamespace:"svg",template:'<g ng-attr-transform="translate({{translate()}})" ng-transclude />',replace:!0,transclude:!0,require:["?^primerFeature","^primerTrack"],scope:{text:"@primerLabel",orient:"@",anchor:"@"},controller:function(){},link:function(a,b,c,d){function e(){var b=i.width();return"start"===a.anchor?j:"end"===a.anchor?j+b:j+b/2}function f(){var b=i.height(),c=g?0:b/2;return"top"===a.orient?c-b/2-6:"bottom"===a.orient?c+b/2+9:c+3}var g=d[0],h=d[1],i=g||h,j=g?0:25;a.translate=function(){return""+e()+","+f()};var k=d3.select(b[0]),l=function(){var b=a.anchor||"middle";g||(b="start"===b?"end":"start"),k.selectAll("text").remove(),k.append("text").attr("text-anchor",b).attr("alignment-baseline","middle").text(a.text)};a.text&&a.$watchCollection("[anchor, text]",l)}}}).directive("primerScale",function(){return{restrict:"EA",templateNamespace:"svg",template:'<g><g ng-attr-transform="translate(0,{{yPosition()}})" ng-transclude /></g>',replace:!0,transclude:!0,require:["?^primerFeature","^primerTrack"],scope:{orient:"@",ticks:"&",outerTickSize:"&",innerTickSize:"&",tickPadding:"&",format:"=?"},link:function(a,b,c,d){function e(a){if("function"==typeof a)return a;if("string"==typeof a&&""===a)return function(){return""};a=a||"s|bp";var b=a.split("|"),c=d3.format(b[0]||"s"),d=b[1]||"";return function(a){return c(a)+d}}function f(){var b=h.xScale;g&&g.width&&(b=d3.scale.linear().domain([g.start(),g.end()]).range([0,i.width()]));var c=a.orient||"middle",d="middle"===c?[i.height()/2+6||6,0]:[6,6];k.scale(b).ticks(void 0!==a.ticks()?a.ticks():5).tickPadding(void 0!==a.tickPadding()?a.tickPadding():3).innerTickSize(void 0!==a.innerTickSize()?a.innerTickSize():d[0]).outerTickSize(void 0!==a.outerTickSize()?a.outerTickSize():d[1]).tickFormat(e(a.format)).orient(c),j.call(k)}var g=d[0],h=a.track=d[1],i=a.parent=g||h,j=d3.select(b.find("g")[0]),k=d3.svg.axis();a.yPosition=function(){var b=i.height();return"top"===a.orient?-5:"bottom"===a.orient?b+5:b/2},f(),a.$watchCollection("[track.sequenceLength(),parent.width(),parent.height(),orient,format,ticks,outerTickSize]",f)}}})}();