/*
 * angular-primer 0.0.1
 * (c) 2014 J. Harshbarger
 * Licensed MIT
 */
!function(){"use strict";angular.module("angularprimer",[]).directive("primerTrack",function(){return{restrict:"AE",templateNamespace:"svg",template:"<g ng-transclude></g>",replace:!1,transclude:!0,require:"primerTrack",scope:{sequence:"@",sequenceLength:"&",width:"&"},link:function(a,b,c,d){d.elm=b},controller:function(a){function b(){c.xScale=d3.scale.linear().domain([0,c.sequenceLength()]).range([25,c.width()+25])}var c=a.track=this;c.sequence=a.sequence,c.sequenceLength=function(){return a.sequenceLength()||a.sequence.length||100},c.width=function(){return a.width()},b(),a.$watchCollection("[sequence,sequenceLength(),width()]",b)}}}).directive("primerFeature",function(){return{restrict:"AE",templateNamespace:"svg",template:'<g ng-attr-transform="translate({{track.xScale(start)}},0)" ><path ng-attr-d="{{d}}" /><title>{{title()}}</title><text text-anchor="middle" alignment-baseline="middle" class="mlabel" ng-attr-x="{{track.xScale(end)/2 - track.xScale(start)/2}}" ng-attr-y="{{labely() + (height()/2)}}">{{label}}</text></g>',replace:!1,transclude:!0,require:"^primerTrack",scope:{start:"=",end:"=",height:"&",label:"@",labely:"&",direction:"@"},link:function(a,b,c,d){function e(){var b=10,c=d.xScale(a.end)-d.xScale(a.start),e=a.direction;b>c&&(e="none"),0>c&&(c=1),"left"==e?(c-=b,a.d="M0,5 l10,10 l0,-5 l"+c+",0 l0,-10 l-"+c+",0 l0,-5 z"):"right"==e?(c-=b,a.d="M0,0 l"+c+",0 l0,-5 l10,10 l-10,10 l0,-5 l-"+c+",0 z"):a.d="M0,0 l"+c+",0 l0,10 l-"+c+",0 z"}a.track=d,a.title=function(){return d.sequence?d.sequence.substring(a.start,a.end):""},e(),a.$watchCollection("[track.sequenceLength(),track.width(),start,end,direction]",e)}}}).directive("primerScale",function(){return{restrict:"AE",templateNamespace:"svg",template:'<text text-anchor="end" alignment-baseline="middle" class="mlabel" ng-attr-x="{{track.xScale(0)-5}}" y="5">{{labelLeft}}</text><text text-anchor="start" alignment-baseline="middle" class="mlabel" ng-attr-x="{{track.xScale(track.sequenceLength())+5}}" y="5">{{labelRight}}</text><g transform="translate(0,5)"></g>',replace:!1,transclude:!0,require:"^primerTrack",scope:{orient:"@",ticks:"&",outerTickSize:"&",innerTickSize:"&",tickPadding:"&",labelLeft:"@",labelRight:"@"},link:function(a,b,c,d){function e(){console.log(a.outerTickSize()),g.scale(d.xScale).ticks(void 0!==a.ticks()?a.ticks():10).tickPadding(void 0!==a.tickPadding()?a.tickPadding():3).innerTickSize(void 0!==a.innerTickSize()?a.innerTickSize():6).outerTickSize(void 0!==a.outerTickSize()?a.outerTickSize():6).orient(a.orient||"bottom"),f.call(g)}a.track=d;var f=d3.select(b.find("g")[0]),g=d3.svg.axis();e(),a.$watchCollection("[track.sequenceLength(),track.width(),orient,ticks,outerTickSize]",e)}}})}();