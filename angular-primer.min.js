/*
 * angular-primer 0.0.1
 * (c) 2014 J. Harshbarger
 * Licensed MIT
 */
!function(){"use strict";angular.module("angularprimer",[]).directive("primerTrack",function(){return{restrict:"A",templateNamespace:"svg",template:"<g ng-transclude></g>",replace:!1,transclude:!0,require:"primerTrack",scope:{sequence:"@",sequenceLength:"&",start:"&",width:"&",height:"&"},controller:function(a,b){var c=a.track=this;c.sequence=function(){return a.sequence},c.sequenceLength=function(){return void 0!==a.sequenceLength()?a.sequenceLength():void 0!==a.sequence?a.sequence.length:100},c.height=function(){return a.height()||10},c.start=b.start?a.start:function(){return 1},c.width=b.width?a.width:function(){return 500},c.xScale=d3.scale.linear()},link:function(a,b,c,d){function e(){d.xScale.domain([d.start()-1||1,d.sequenceLength()+1]).range([25,d.width()+25])}a.$watchCollection("[track.sequenceLength(),track.width(),track.start()]",e)}}}).directive("primerFeature",function(){return{restrict:"A",templateNamespace:"svg",template:'<g ng-attr-transform="translate({{translate()}})"><path ng-attr-d="{{d}}" /><title ng-bind="title()"></title></text><g ng-transclude /></g>',replace:!1,transclude:!0,require:["primerFeature","^primerTrack"],scope:{start:"=",end:"=",height:"&",direction:"@"},controller:function(a){var b=this;b.start=function(){return a.start||0},b.end=function(){return a.end||a.start}},link:function(a,b,c,d){function e(){return(i.height()-h.height())/2}function f(){return i.xScale(h.start())}function g(){var b=10,c=h.width(),d=h.height(),e=a.direction;b>c&&(b=c),0>c&&(c=1),"left"==e?(c-=b,a.d="M0,"+d/2+" l"+b+","+(d/2+5)+" l0,-5 l"+c+",0 l0,-"+d+" l-"+c+",0 l0,-5 z"):"right"==e?(c-=b,a.d="M0,0 l"+c+",0 l0,-5 l"+b+","+(d/2+5)+" l-"+b+","+(d/2+5)+" l0,-5 l-"+c+",0 z"):a.d="M0,0 l"+c+",0 l0,"+d+" l-"+c+",0 z"}var h=a.feature=d[0],i=a.track=d[1];h.height=c.height?function(){return a.height()||i.height()||10}:function(){return i.height()||10},h.width=function(){return i.xScale(h.end()+1)-i.xScale(h.start())},a.translate=function(){return""+f()+","+e()},a.title=function(){var a=""+h.start()+"-"+h.end();return i.sequence()&&(a+=" "+i.sequence().substring(h.start()-1,h.end())),a},a.$watchCollection("[feature.width(),feature.height(),direction]",g)}}}).directive("primerLabel",function(){return{restrict:"A",templateNamespace:"svg",template:'<g ng-attr-transform="translate({{translate()}})" ng-transclude />',replace:!0,transclude:!0,require:["?^primerFeature","^primerTrack"],scope:{orient:"@",anchor:"@"},controller:function(){},link:function(a,b,c,d){function e(){var b=h?0:25;if("start"===a.anchor)return b;var c=h?h.width():g.width()+25;return"end"===a.anchor?c:(c-b)/2}function f(){if("top"===a.orient)return-6;var b=i();return"bottom"===a.orient?b+9:b/2+2}var g=d[1],h=d[0],i=h?function(){return h.height()}:function(){return g.height()};a.translate=function(){return""+e()+","+f()}}}}).directive("primerScale",function(){return{restrict:"A",templateNamespace:"svg",template:'<g ng-attr-transform="translate(0,{{yPosition()}})"></g><g ng-transclude />',replace:!1,transclude:!0,require:"^primerTrack",scope:{orient:"@",ticks:"&",outerTickSize:"&",innerTickSize:"&",tickPadding:"&",format:"=?"},link:function(a,b,c,d){function e(a){if("function"==typeof a)return a;a=a||"s|bp";var b=a.split("|"),c=d3.format(b[0]||"s"),d=b[1]||"";return function(a){return c(a)+d}}function f(){var b=a.orient||"middle",c="middle"===b?[d.height()/2+6||6,0]:[6,6];h.scale(d.xScale).ticks(void 0!==a.ticks()?a.ticks():5).tickPadding(void 0!==a.tickPadding()?a.tickPadding():3).innerTickSize(void 0!==a.innerTickSize()?a.innerTickSize():c[0]).outerTickSize(void 0!==a.outerTickSize()?a.outerTickSize():c[1]).tickFormat(e(a.format)).orient(b),g.call(h)}a.track=d;var g=d3.select(b.find("g")[0]),h=d3.svg.axis();a.yPosition=function(){return"top"===a.orient?-5:"bottom"===a.orient?d.height()+5:d.height()/2},f(),a.$watchCollection("[track.sequenceLength(),track.width(),track.height(),orient,format,ticks,outerTickSize]",f)}}})}();