/*
 * angular-primer 0.0.1
 * (c) 2014 J. Harshbarger
 * Licensed MIT
 */
!function(){"use strict";angular.module("angularprimer",[]).directive("primerTrack",function(){return{restrict:"A",templateNamespace:"svg",template:"<g ng-transclude></g>",replace:!1,transclude:!0,require:"primerTrack",scope:{sequence:"@",sequenceLength:"&",start:"&",width:"&",height:"&"},link:function(a,b,c,d){d.elm=b},controller:function(a){function b(){c.xScale=d3.scale.linear().domain([a.start()-1||1,c.sequenceLength()+1]).range([25,c.width()+25])}var c=a.track=this;c.sequence=function(){return a.sequence},c.height=function(){return a.height()||10},c.sequenceLength=function(){return void 0!==a.sequenceLength()?a.sequenceLength():void 0!==a.sequence?a.sequence.length:100},c.start=function(){return a.start()||1},c.width=function(){return a.width()||500},b(),a.$watchCollection("[sequence,sequenceLength(),width()]",b)}}}).directive("primerFeature",function(){return{restrict:"A",templateNamespace:"svg",template:'<g ng-attr-transform="translate({{track.xScale(start)}},0)"><path ng-attr-d="{{d}}" /><title ng-bind="title()"></title><text text-anchor="middle" alignment-baseline="middle" ng-attr-x="{{track.xScale(end)/2 - track.xScale(start)/2}}" ng-attr-y="{{labely() + (height()/2)}}">{{label}}</text><g ng-transclude /></g>',replace:!1,transclude:!0,require:["primerFeature","^primerTrack"],scope:{start:"=",end:"=",height:"&",direction:"@"},controller:function(){},link:function(a,b,c,d){function e(){var b=10,c=g.xScale(a.end+1)-g.xScale(a.start),d=a.direction;b>c&&(d="none"),0>c&&(c=1);var e=a.height();"left"==d?(c-=b,a.d="M0,"+e/2+" l10,"+(e/2+5)+" l0,-5 l"+c+",0 l0,-"+e+" l-"+c+",0 l0,-5 z"):"right"==d?(c-=b,a.d="M0,0 l"+c+",0 l0,-5 l10,10 l-10,10 l0,-5 l-"+c+",0 z"):a.d="M0,0 l"+c+",0 l0,"+e+" l-"+c+",0 z"}var f=a.feature=d[0],g=a.track=d[1];f.start=function(){return a.start},f.end=function(){return a.end},c.height||(a.height=function(){return g.height()||10}),f.height=a.height,a.title=function(){return g.sequence()?g.sequence().substring(a.start-1,a.end):""+a.start+"-"+a.end},e(),a.$watchCollection("[track.sequenceLength(),track.width(),height(),start,end,direction]",e)}}}).directive("primerLabel",function(){return{restrict:"A",templateNamespace:"svg",template:'<g ng-transclude ng-attr-transform="translate({{translate()}})"></g>',replace:!0,transclude:!0,require:["?^primerFeature","^primerTrack"],scope:{orient:"@"},link:function(a,b,c,d){var e=a.track=d[1],f=a.feature=d[0];a.translate=function(){return""+a.xPosition()+","+a.yPosition()},a.xPosition=function(){var b=f?e.xScale(f.start()):25;if("left"===a.orient)return b-5;var c=f?e.xScale(f.end()):e.width()+25;return"right"===a.orient?c+5:c/2-b/2},a.yPosition=function(){var b=f?f.height():e.height();return"top"===a.orient?-5:"bottom"===a.orient?2*b+5:b/2}}}}).directive("primerScale",function(){return{restrict:"A",templateNamespace:"svg",template:'<g ng-attr-transform="translate(0,{{yPosition()}})"></g><g ng-transclude />',replace:!1,transclude:!0,require:"^primerTrack",scope:{orient:"@",ticks:"&",outerTickSize:"&",innerTickSize:"&",tickPadding:"&"},link:function(a,b,c,d){function e(){var a=d3.format("s");return function(b){return a(b)+"bp"}}function f(){var b=a.orient||"middle",c="middle"===b?0:6;h.scale(d.xScale).ticks(void 0!==a.ticks()?a.ticks():5).tickPadding(void 0!==a.tickPadding()?a.tickPadding():3).innerTickSize(void 0!==a.innerTickSize()?a.innerTickSize():c).outerTickSize(void 0!==a.outerTickSize()?a.outerTickSize():c).tickFormat(e()).orient(b),g.call(h)}a.track=d;var g=d3.select(b.find("g")[0]),h=d3.svg.axis();a.yPosition=function(){return"top"===a.orient?-5:"bottom"===a.orient?d.height()+5:d.height()/2},f(),a.$watchCollection("[track.sequenceLength(),track.width(),orient,ticks,outerTickSize]",f)}}})}();