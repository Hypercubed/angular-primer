/*
 * angular-primer 0.0.7
 * (c) 2014 J. Harshbarger
 * Licensed MIT
 */
!function(){"use strict";angular.module("angularprimer",[]).directive("primerTrack",function(){return{restrict:"EA",templateNamespace:"svg",template:"<g ng-transclude></g>",replace:!0,transclude:!0,require:"primerTrack",scope:{sequence:"@",sequenceLength:"&",start:"&",width:"&",height:"&"},controllerAs:"track",controller:function(a,b){var c=this;c.sequence=function(){return b.sequence},c.sequenceLength=function(){return void 0!==a.sequenceLength()?+a.sequenceLength():void 0!==a.sequence?+a.sequence.length:100},c.height=function(){return a.height()||10},c.start=angular.isDefined(b.start)?a.start:function(){return 0},c.width=angular.isDefined(b.width)?a.width:function(){return 500},c.xScale=d3.scale.linear(),a.xScale=c.xScale},link:function(a,b,c,d){function e(){d.xScale.domain([+d.start(),+d.start()+d.sequenceLength()]).range([f,+d.width()+f])}var f=25;a.$watchGroup([d.sequenceLength,d.width,d.start],e)}}}).directive("primerFeature",function(){return{restrict:"EA",templateNamespace:"svg",template:'<g><g ng-attr-transform="translate({{translate()}})"><title ng-bind="title()" /><g ng-transclude></g></g><g>',replace:!0,transclude:!0,require:["primerFeature","^primerTrack"],scope:{start:"=",end:"=",height:"&",direction:"@"},controllerAs:"feature",controller:function(a,b){var c=this;c.type="feature",c.somethingElse="test 1 2 3",c.start=function(){return angular.isDefined(b.start)?parseInt(a.start):a.track.start()},c.end=function(){return angular.isDefined(a.end)?parseInt(a.end):c.start()+1},c.height=function(){return parseInt(a.height())||10},c.width=function(){return a.track?a.track.xScale(c.end())-a.track.xScale(c.start()):100},c.sequenceLength=function(){return c.end()-c.start()}},link:function(a,b,c,d){var e=a.feature=d[0],f=a.track=d[1];e.xScale=a.track.xScale,a.xScale=e.xScale,e.xScale=d3.scale.linear().domain([e.start(),e.end()]).range([0,e.width()]),angular.isDefined(c.height)||(a.height=function(){return f.height()||10}),angular.isDefined(c.height)&&(e.height=a.height),e.sequence=function(){var a=f.sequence();if(a){var b=e.start()-f.start(),c=e.end()-f.start();return a.substring(b,c)}return void 0},e=angular.extend({},f,e),a.translate=function(){var a=f.xScale(e.start()),b=f.height()/2;return""+a+","+b},a.title=function(){var a=""+e.start()+"-"+e.end();return e.sequence()&&(a+=" "+e.sequence()),a}}}}).directive("primerFeatureShape",function(){var a=5,b={box:function(a,b){return"M0,-"+b/2+" l"+a+",0 l0,"+b+" l-"+a+",0 z"},"arrow-left":function(b,c){var d=a,e=Math.min(b,d),f=b-e;return"M0,0 l"+e+","+(c/2+d)+" l0,-"+d+" l"+f+",0 l0,-"+c+" l-"+f+",0 l0,-"+d+" z"},"arrow-right":function(b,c){var d=a,e=Math.min(b,d),f=b-e;return"M0,-"+c/2+" l"+f+",0 l0,-"+d+" l"+e+","+(c/2+d)+" l-"+e+","+(c/2+d)+" l0,-"+d+" l-"+f+",0 z"},"box-left":function(a,b){var c=0,d=Math.min(a,10),e=a-d;return"M0,0 l"+d+","+(b/2+c)+" l0,-"+c+" l"+e+",0 l0,-"+b+" l-"+e+",0 l0,-"+c+" z"},"box-right":function(a,b){var c=0,d=Math.min(a,10),e=a-d;return"M0,-"+b/2+" l"+e+",0 l0,-"+c+" l"+d+","+(b/2+c)+" l-"+d+","+(b/2+c)+" l0,-"+c+" l-"+e+",0 z"},"chevron-up":function(a,b){return"M0,0 l"+a/2+",-"+b/2+" l"+a/2+","+b/2},"chevron-down":function(a,b){return"M0,0 l"+a/2+","+b/2+" l"+a/2+",-"+b/2},"triangle-up":function(a,b){return"M0,"+b/2+" l"+a/2+",-"+b+" l"+a/2+","+b+" z"},"triangle-down":function(a,b){return"M0,-"+b/2+" l"+a/2+","+b+" l"+a/2+",-"+b+" z"},diamond:function(a,b){return"M0,0 l"+a/2+",-"+b/2+" l"+a/2+","+b/2+" l-"+a/2+","+b/2+" z"},"arc-up":function(a,b){return"M0,0 a "+a/2+" "+b/2+" 0 0 1 "+a+" 0"},"arc-down":function(a,b){return"M0,0 a "+a/2+" -"+b/2+" 0 0 0 "+a+" 0"},ellipse:function(a,b){return"M0,0 a "+a/2+" "+b/2+" 0 0 1 "+a+" 0 M0,0 a "+a/2+" -"+b/2+" 0 0 0 "+a+" 0"}};return{restrict:"EA",templateNamespace:"svg",template:"<path />",replace:!0,transclude:!1,require:["primerFeatureShape","^primerFeature"],scope:{type:"@primerFeatureShape",height:"&?"},controller:function(){},link:function(a,c,d,e){function f(){var d=g.width()||1,e=g.height()||10,f=void 0===a.type||0===a.type.length||"rect"===a.type?"box":a.type;0>d&&(d=1);var h=b[f]||d3.svg.symbol().type(f).size(e*e);c.attr({d:h(d,e)})}var g=e[0],h=e[1];d.height&&(g.height=a.height),g=angular.extend({},h,g),d.$observe("primerFeatureShape",f),a.$watchGroup([g.width,g.height],f),d.$observe(["height","primerFeatureShape"],f)}}}).directive("primerLabel",function(){return{restrict:"EA",templateNamespace:"svg",template:'<g><g ng-attr-transform="translate({{translate()}})" ng-transclude /></g>',replace:!0,transclude:!0,require:["?^primerFeature","^primerTrack"],scope:{text:"@primerLabel",orient:"@",anchor:"@"},controller:function(){},link:function(a,b,c,d){function e(){var b=j.width();return"start"===a.anchor?k:"end"===a.anchor?k+b:k+b/2}function f(){var b=j.height(),c=h?0:b/2;return"top"===a.orient?c-b/2-6:"bottom"===a.orient?c+b/2+9:c+3}function g(){var b=a.anchor||"middle";h||("start"===b?b="end":"end"===b&&(b="start")),l.selectAll("text").remove(),l.append("text").attr("text-anchor",b).attr("alignment-baseline","middle").text(a.text)}var h=d[0],i=d[1],j=angular.extend({},i,h),k=h?0:25;a.translate=function(){return""+e()+","+f()};var l=d3.select(b[0]).select("g");c.primerLabel&&c.$observe(["anchor","text"],g)}}}).directive("primerScale",function(){return{restrict:"EA",templateNamespace:"svg",template:'<g><g ng-attr-transform="translate(0,{{yPosition()}})" ng-transclude /></g>',replace:!0,transclude:!0,require:["?^primerFeature","^primerTrack"],scope:{orient:"@",ticks:"&",outerTickSize:"&",innerTickSize:"&",tickPadding:"&",format:"=?"},link:function(a,b,c,d){function e(a){if("function"==typeof a)return a;if("string"==typeof a&&""===a)return function(){return""};a=a||"s|bp";var b=a.split("|"),c=d3.format(b[0]||"s"),d=b[1]||"";return function(a){return c(a)+d}}function f(){var b=i.xScale,c=a.orient||"middle",d="middle"===c?[i.height()/2+6||6,0]:[6,6];k.scale(b).ticks(void 0!==a.ticks()?a.ticks():5).tickPadding(void 0!==a.tickPadding()?a.tickPadding():3).innerTickSize(void 0!==a.innerTickSize()?a.innerTickSize():d[0]).outerTickSize(void 0!==a.outerTickSize()?a.outerTickSize():d[1]).tickFormat(e(a.format)).orient(c),j.call(k)}var g=d[0],h=d[1],i=g||h,j=d3.select(b.find("g")[0]),k=d3.svg.axis(),l=5;a.yPosition=function(){var b=i.height();return"top"===a.orient?g?-b/2-l:-l:"bottom"===a.orient?g?+b/2+l:b+l:g?0:b/2},f(),a.$watchGroup([h.sequenceLength,i.width,i.height],f),a.$watchCollection("[orient,format,ticks(),outerTickSize()]",f)}}})}();